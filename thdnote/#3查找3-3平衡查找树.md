# 3.3 平衡查找树
## 3.3.1 2-3查找树
- 一棵**2-3查找树**或为*一棵空树*，或由以下结点组成：
  - 2-结点，含有一个键（及其对应的值）和两条链接，**左链接** 指向的2-3树中的键都**小于**该结点，**右链接** 指向的2-3树种的键都**大于**该结点。
  - 3-结点，含有两个键（及其对应的值）和三条链接，在左链接指向的2-3树中的键都小于该结点，**中链接** 指向的2-3树中的键都**位于该结点的两个键之间**，右链接指向的2-3树中的键都大于该结点。
  - 指向一棵空树的链接称为**空链接**。
  ![图3.3.1](/assets/图3.3.1.png)
- 一棵**完美平衡**的2-3查找树中的所有空链接到根结点的距离都应该是相同的。
- **查找**：要判断一个键是否在树中，我们先将它和根结点中的键比较。如果它和其中任意一个相等，查找命中；否则我们就根据比较的结果找到指向相应区间的链接，并在其指向的子树中递归地继续查找。如果这是个空链接，查找未命中。
  ![图3.3.2](/assets/图3.3.2.png)
- **向2-结点中插入新键**：先进行一次未命中的查找，如果结束于一个2-结点，只需把这个2-结点替换为一个3-结点，将要插入的键保存其中即可。
  ![图3.3.3](/assets/图3.3.3.png)
- **向一棵只含有一个3-结点的树中插入新键**：先临时将新键存入该结点中，使之成为一个4-结点。然后将它转换成一棵有3个2-结点组成的2-3树，其中一个结点（根）含有中键，一个结点含有3个键中的最小者（和根结点的左链接相连），一个结点含有3个键中的最大者（和根结点的右链接相连）。
  ![图3.3.4](/assets/图3.3.4.png)
- **向一个父结点为2-结点的3-结点中插入新键**：*在维持树的完美平衡的前提下为新键腾出空间*。先构造一个临时的4-结点并将其分解，然后将其中键移动至原来的父结点中。
  ![图3.3.5](/assets/图3.3.5.png)
- **向一个父结点为3-结点的3-结点中插入新键**：再次和刚才一样构造一个临时的4-结点并分解它，然后将它的中键插入到它的父结点中。单父结点也是一个3-结点，因此要已知向上进行上述变换，直到遇到一个2-结点并将它替换为一个不需要继续分解的3-结点，或者是到达3-结点的根。
  ![图3.3.6](/assets/图3.3.6.png)
- **分解根结点**：如果从插入结点到根结点的路径上全都是3-结点，则将根结点按上述处理，最终树高加1。
  ![图3.3.7](/assets/图3.3.7.png)
- **局部变换**：将一个4-结点分解为一棵2-3树可能有6种情况。2-3树插入算法的根本在于这些变换都是**局部的**：除了相关的结点和链接之外不必修改或者检查树的其他部分。
  ![图3.3.8](/assets/图3.3.8.png)
- **全局性质**：这些全局变换不会影响数的全局有序性和平衡性：任意空链接到根结点的路径长度都是相等的。
  ![图3.3.9](/assets/图3.3.9.png)
- 和标准的二叉查找树由上向下生长不同，2-3树的生长是由下向上的。
  ![命题3f](/assets/命题3f.png)
  ![图3.3.10](/assets/图3.3.10.png)
## 3.3.2 红黑二叉查找树
- **替换3-结点**：红黑二叉查找树背后的基本思想是用标准的二叉查找树（完全由2-结点构成）和一些额外的信息（替换3-结点）来表示2-3树。将树中的链接分为两种类型：**红链接** 将两个2-结点连接起来构成一个3-结点， **黑链接** 则是2-3树中的普通链接。确切地说，我们将3-结点表示为由一条**左斜** 的红色链接（两个2-结点其中之一是另一个的左子结点）相连的两个2-结点，如图。这样表示的一个有点：我们*无需修改*就可以直接使用标准二叉查找树的`get()`方法。对于任意的2-3树，我们只要对结点进行转换，我们都可以直接派出一棵对应的二叉查找树。我们称这种法师表示2-3树的二叉查找树为**红黑二叉查找树**（简称红黑树）。
- 红黑树的另一种**定义**是含有红黑链接并满足下列条件的二叉查找树：
  - 红链接均为左链接；
  - 没有任何一个结点同时和两条红链接相连；
  - 该树是**完美黑色平衡**的，即任何空链接到根结点的路径上的黑链接数量相同。
- **一一对应**：红黑树*既*是二叉查找树，*也*是2-3树。
  ![图3.3.13](/assets/图3.3.13.png)
  ![图3.3.14](/assets/图3.3.14.png)
- **颜色表示**：方便起见，我们将链接的颜色保存在表示结点的Node数据类型的布尔变量color中。如果**指向它**的链接是红色的，那么该变量为true，黑色则为false。我们约定空链接为黑色。
  ![图3.3.15](/assets/图3.3.15.png)
- **旋转**
